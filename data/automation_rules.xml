<odoo>
    <data>
        <!-- Acción de Servidor -->
        <record id="action_send_to_n8n" model="ir.actions.server">
            <field name="name">Bridge n8n: Ejecutar Webhook</field>
            <field name="model_id" ref="mail.model_mail_message"/>
            <field name="state">code</field>
            <field name="code">record._notify_n8n()</field>
        </record>

        <!-- Regla de Automatización -->
        <record id="rule_send_to_n8n" model="base.automation">
            <field name="name">Bridge n8n: Enviar Mensajes LiveChat</field>
            <field name="model_id" ref="mail.model_mail_message"/>
            <field name="trigger">on_create</field>
            <field name="action_server_ids" eval="[(4, ref('action_send_to_n8n'))]"/>
        </record>

        <!-- VISTA MOVIDA AQUÍ PARA PRUEBA -->
        <record id="im_livechat_channel_view_form_n8n" model="ir.ui.view">
            <name>im_livechat.channel.view_form_n8n</name>
            <model>im_livechat.channel</model>
            <inherit_id ref="im_livechat.im_livechat_channel_view_form"/>
            <arch type="xml">
                <xpath expr="//notebook" position="inside">
                    <page string="Configuración n8n" name="n8n_config">
                        <group>
                            <group string="Webhooks">
                                <field name="n8n_webhook_url" placeholder="https://n8n.ejemplo.com/webhook/..."/>
                            </group>
                            <group string="Seguridad y Tokens">
                                <field name="n8n_outgoing_token" password="True"/>
                                <field name="n8n_incoming_token" password="True"/>
                            </group>
                        </group>
                    </page>
                </xpath>
            </arch>
        </record>
    </data>
</odoo>
